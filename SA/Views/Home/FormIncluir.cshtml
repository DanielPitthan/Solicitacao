@model SA.Models.Solicitacao
@{
    ViewBag.Title = "FormIncluir";
}

@section ScriptsHead{
    
}


@using (Html.BeginForm("Adicionar", "Home", FormMethod.Post))
{
    @Html.Partial("_FormSa")
   
}



<div class="modal fade" id="avisomodal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog avisomodal">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title alert alert-danger"></h4>
        </div>
        <div class="modal-body">
            <p></p>
        </div>
        <div class="modal-footer">           
            <button type="button" class="btn btn-danger" data-dismiss="modal">Fechar</button>
        </div>
    </div>
</div>





@section Scripts{
      <script src="~/Content/Scripts/jquery.validate.js"></script>    
      <script src="~/Content/Scripts/jquery.validate.unobtrusive.js"></script>
      <script src="~/Content/Scripts/sa-vars.js"></script>
      <script src="~/Content/Scripts/sa-validacoes.js"></script>
      <script src="~/Content/Scripts/sa.js"></script>
      <script src="~/Content/Scripts/sa-eventos.js"></script>
      
<script type="text/javascript">
        $(document).ready(function () {
            $('[data-toggle="tooltip"]').tooltip();
        });
</script>


    <script>        
        /**
         * Pega a lista de produtos
         */
        var urlprd = "@Url.Action("GetLista", "Produtos")";
        var produtodigita = document.getElementById("produto");

        produtodigita.onkeypress = function()
        {
            
          

            //Verifica se a quantide digitada é maior que 2
            if (produtodigita.value.length > 2) {

                //Faz a consulta no server pela digitação
                $.ajax({
                    url: urlprd,
                    type: "POST",
                    data: { 'produtoDesci': produtodigita.value },
                    success: function (response) {

                        MontaListaProduto(response);

                    },
                    error: function (response) {
                        console.log("Erro! Não encontrei o produto");
                    }
                })
            }
        }
    </script>

    <script>

        /**
         * Recupera o saldo em estoque
         */
        var urlest = "@Url.Action("GetEstoque", "Produtos")";
        var quant = document.getElementById("quantidade");
        var produtodigita = document.getElementById("produto");
        produtodigita.onblur = function () {

            //Busca a lista de produtos
            var listaProduto = document.getElementById("lstproduto");
            var codigoPrd = this.value.substring(0, 15);

            $.ajax({
                url: urlest,
                type: "POST",
                data: { "produtoCod": codigoPrd },
                success: function (response) {                    

                    AtualizaEstoque(response);
                    
                },
                error: function (response) {
                    console.log("Produto não localizado!");
                }
            })

        }
    </script>
    <script>
        /**
         * Envia os dados para o serer
         */
        var btnInclui = document.getElementById("btnGravarSA");
        var urlIncluir = "@Url.Action("Adicionar", "Home")";

        btnInclui.onclick = function () {
            $.ajax({
                url: urlIncluir,
                type: "POST",
                data: { "itenSa": dados },
                dataType: "json",
                success: function (response) {
                    console.log("Solicitação Gravada com sucesso!")
                    dados = new Array();
                    var url = "@Url.Action("Index", "Home")";
                    window.location.replace(url);
                },
                error: function (response) {
                    console.log("Erro ao salvar SA!");
                }
            })
        }

    </script>
     
}